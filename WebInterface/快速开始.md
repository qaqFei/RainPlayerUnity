# ğŸ® Rain Player WebGL API - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ä½ çš„éœ€æ±‚

> æˆ‘è¦æ‰“åŒ… WebGLï¼Œæƒ³ç›´æ¥é€šè¿‡ API ä¼ å…¥ .jsonï¼Œå°é¢ï¼ŒéŸ³é¢‘ï¼Œå¦‚ä½•åšï¼Ÿæ€ä¹ˆä¿®æ”¹ï¼Ÿå¦ä¸€è¾¹æˆ‘æ˜¯ Vue+js çš„é¡¹ç›®ï¼Œå¦‚ä½•æ¥å…¥ï¼Ÿ

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

æˆ‘ä»¬å·²ç»å®Œæ•´å®ç°äº†ä½ éœ€è¦çš„æ‰€æœ‰åŠŸèƒ½ï¼

### 1. ç›´æ¥é€šè¿‡ API ä¼ å…¥èµ„æº âœ¨

ç°åœ¨ä½ å¯ä»¥ç›´æ¥ä¼ å…¥ JSONã€éŸ³é¢‘å’Œå°é¢ï¼Œ**æ— éœ€æ‰“åŒ…æˆ ZIP æ–‡ä»¶**ï¼

```javascript
RainPlayer.configure({
    webglBuildDir: '/webgl_build_dir'
});

const player = RainPlayer.instantiate({
    chartData: yourChartObject,    // ç›´æ¥ä¼ å…¥ JS å¯¹è±¡
    audioUrl: '/audio.mp3',        // éŸ³é¢‘ URL
    coverUrl: '/cover.jpg',        // å°é¢ URL
    container: document.body,
    noteSize: 1.15,
    autoPlay: false
});

await player.waitLoaded();
```

### 2. æ”¯æŒå¤šç§æ•°æ®æ ¼å¼

ä½ å¯ä»¥é€‰æ‹©æœ€é€‚åˆä½ çš„æ–¹å¼ï¼š

#### æ–¹å¼ Aï¼šä½¿ç”¨ URL
```javascript
{
    chartData: chartObject,
    audioUrl: '/path/to/audio.mp3',
    coverUrl: '/path/to/cover.jpg'
}
```

#### æ–¹å¼ Bï¼šä½¿ç”¨ Blobï¼ˆé€‚åˆæ–‡ä»¶ä¸Šä¼ ï¼‰
```javascript
{
    chartJson: JSON.stringify(chartObject),
    audioBlob: audioFileBlob,
    coverBlob: coverFileBlob
}
```

#### æ–¹å¼ Cï¼šä½¿ç”¨ ArrayBufferï¼ˆé€‚åˆäºŒè¿›åˆ¶æ•°æ®ï¼‰
```javascript
{
    chartData: chartObject,
    audioData: audioArrayBuffer,
    coverData: coverArrayBuffer
}
```

### 3. Vue.js å®Œæ•´é›†æˆ ğŸ¯

#### ç¬¬ä¸€æ­¥ï¼šå®‰è£…

1. å¤åˆ¶ `WebInterface/rain_player.js` åˆ° `public/`
2. å¤åˆ¶ WebGL æ„å»ºäº§ç‰©åˆ° `public/webgl_build_dir/`
3. åœ¨ `public/index.html` ä¸­æ·»åŠ ï¼š
   ```html
   <script src="/rain_player.js"></script>
   ```

#### ç¬¬äºŒæ­¥ï¼šä½¿ç”¨ç»„ä»¶

**é€‰é¡¹ 1ï¼šç›´æ¥ä½¿ç”¨æˆ‘ä»¬æä¾›çš„ç»„ä»¶**

å¤åˆ¶ `WebInterface/RainPlayer.vue` åˆ°ä½ çš„é¡¹ç›®ï¼Œç„¶åï¼š

```vue
<template>
  <RainPlayer
    :chart-data="chartData"
    :audio-url="audioUrl"
    :cover-url="coverUrl"
    :options="{ noteSize: 1.15, autoPlay: false }"
    @loaded="onLoaded"
    @back-to-hub="goBack"
  />
</template>

<script>
import RainPlayer from '@/components/RainPlayer.vue';

export default {
  components: { RainPlayer },
  data() {
    return {
      chartData: null,
      audioUrl: '',
      coverUrl: ''
    };
  },
  async mounted() {
    // ä»ä½ çš„ API è·å–æ•°æ®
    const response = await fetch('/api/charts/123');
    const data = await response.json();
    
    this.chartData = data.chart;
    this.audioUrl = data.audioUrl;
    this.coverUrl = data.coverUrl;
  },
  methods: {
    onLoaded() {
      console.log('æ¸¸æˆåŠ è½½å®Œæˆ');
    },
    goBack() {
      this.$router.push('/');
    }
  }
};
</script>
```

**é€‰é¡¹ 2ï¼šè‡ªå·±åˆ›å»ºç»„ä»¶**

å‚è€ƒ `WebInterface/VUE_INTEGRATION.md` ä¸­çš„è¯¦ç»†æŒ‡å—ã€‚

## ğŸ“š æ–‡æ¡£èµ„æº

æˆ‘ä»¬ä¸ºä½ å‡†å¤‡äº†å®Œæ•´çš„æ–‡æ¡£ï¼š

1. **API å‚è€ƒæ‰‹å†Œ** - `WebInterface/API.md`
   - å®Œæ•´çš„å‚æ•°è¯´æ˜
   - å¤šä¸ªä½¿ç”¨ç¤ºä¾‹
   - æ³¨æ„äº‹é¡¹

2. **Vue.js é›†æˆæŒ‡å—** - `WebInterface/VUE_INTEGRATION.md`
   - è¯¦ç»†çš„å®‰è£…æ­¥éª¤
   - å¤šç§é›†æˆæ–¹å¼
   - å®Œæ•´çš„åº”ç”¨ç¤ºä¾‹
   - TypeScript æ”¯æŒ

3. **å®ç°ç»†èŠ‚** - `WebInterface/CHANGELOG.md`
   - æŠ€æœ¯å®ç°è¯´æ˜
   - æ¶æ„è®¾è®¡
   - ä½¿ç”¨åœºæ™¯

## ğŸ¨ ç¤ºä¾‹å’Œå·¥å…·

### 1. äº¤äº’å¼æ¼”ç¤ºé¡µé¢
æ‰“å¼€ `WebInterface/example.html`ï¼Œä½ å¯ä»¥ï¼š
- é€‰æ‹©æ–‡ä»¶ï¼ˆJSONã€éŸ³é¢‘ã€å°é¢ï¼‰
- è°ƒæ•´æ¸¸æˆé€‰é¡¹
- ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•

### 2. Vue ç»„ä»¶ç¤ºä¾‹
`WebInterface/RainPlayer.vue` æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Vue 3 ç»„ä»¶ï¼ŒåŒ…å«ï¼š
- åŠ è½½çŠ¶æ€
- é”™è¯¯å¤„ç†
- äº‹ä»¶å‘å°„
- æ ·å¼ç¾åŒ–

### 3. API æµ‹è¯•å·¥å…·
åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ï¼š
```javascript
// åŠ è½½ test-api.js
<script src="/test-api.js"></script>

// è¿è¡Œæµ‹è¯•
RainPlayerTest.runAllTests();

// æŸ¥çœ‹ç¤ºä¾‹
RainPlayerTest.showExamples();
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3 åˆ†é’Ÿï¼‰

### HTML é¡¹ç›®

1. å¤åˆ¶ `rain_player.js` åˆ°ä½ çš„é¡¹ç›®
2. æ·»åŠ åˆ° HTMLï¼š
   ```html
   <script src="/rain_player.js"></script>
   ```
3. ä½¿ç”¨ï¼š
   ```javascript
   RainPlayer.configure({ webglBuildDir: '/webgl_build_dir' });
   const player = RainPlayer.instantiate({
       chartData: yourChart,
       audioUrl: '/audio.mp3',
       coverUrl: '/cover.jpg',
       container: document.body
   });
   ```

### Vue é¡¹ç›®

1. å¤åˆ¶ `rain_player.js` åˆ° `public/`
2. å¤åˆ¶ `RainPlayer.vue` åˆ° `src/components/`
3. åœ¨ä½ çš„é¡µé¢ä¸­ä½¿ç”¨ï¼š
   ```vue
   <RainPlayer :chart-data="chart" audio-url="/audio.mp3" cover-url="/cover.jpg" />
   ```

## ğŸ”„ å‘åå…¼å®¹

**é‡è¦**ï¼šåŸæœ‰çš„ ZIP æ–‡ä»¶æ–¹å¼ä»ç„¶å®Œå…¨æ”¯æŒï¼

```javascript
// æ—§æ–¹å¼ä»ç„¶å¯ç”¨
RainPlayer.instantiate({
    chartUrl: '/chart.zip',
    container: document.body
});
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šåœ¨çº¿è°±é¢åº“
```javascript
// ä»åç«¯ API ç›´æ¥åŠ è½½
async function loadChart(chartId) {
    const res = await fetch(`/api/charts/${chartId}`);
    const data = await res.json();
    
    RainPlayer.instantiate({
        chartData: data.chart,
        audioUrl: data.audioUrl,
        coverUrl: data.coverUrl,
        container: document.body
    });
}
```

### åœºæ™¯ 2ï¼šç”¨æˆ·ä¸Šä¼ è°±é¢
```javascript
// å¤„ç†ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶
async function handleUpload(chartFile, audioFile, coverFile) {
    const chartText = await chartFile.text();
    const chartData = JSON.parse(chartText);
    
    RainPlayer.instantiate({
        chartData: chartData,
        audioBlob: audioFile,
        coverBlob: coverFile,
        container: document.body
    });
}
```

### åœºæ™¯ 3ï¼šVue SPA
```vue
<!-- å®Œå…¨é›†æˆåˆ° Vue Router -->
<template>
  <div class="game-page">
    <RainPlayer
      :chart-data="$store.state.currentChart"
      :audio-url="$store.getters.audioUrl"
      :cover-url="$store.getters.coverUrl"
      @back-to-hub="$router.push('/')"
    />
  </div>
</template>
```

## âš™ï¸ æ¸¸æˆé€‰é¡¹

æ”¯æŒæ‰€æœ‰åŸæœ‰çš„æ¸¸æˆé€‰é¡¹ï¼š

```javascript
{
    flowSpeed: 1.66,           // ä¸‹è½é€Ÿåº¦
    noteSize: 1.15,            // éŸ³ç¬¦å¤§å°
    offset: 0,                 // éŸ³é¢‘åç§»ï¼ˆæ¯«ç§’ï¼‰
    speed: 1.0,                // æ’­æ”¾é€Ÿåº¦
    musicVol: 1.0,             // éŸ³ä¹éŸ³é‡ (0-1)
    hitsoundVol: 1.0,          // æ‰“å‡»éŸ³é‡ (0-1)
    autoPlay: false,           // è‡ªåŠ¨æ’­æ”¾
    debug: false,              // è°ƒè¯•æ¨¡å¼
    chordHL: true,             // å’Œå¼¦é«˜äº®
    elIndicator: false,        // Early/Late æŒ‡ç¤ºå™¨
    showTouchPoint: false,     // æ˜¾ç¤ºè§¦æ‘¸ç‚¹
    oklchColorInterplate: false, // OKLCH é¢œè‰²æ’å€¼
    comboText: ''              // è‡ªå®šä¹‰ Combo æ–‡å­—
}
```

## ğŸ¯ ä¼˜åŠ¿

1. **æ›´å¿«** - è·³è¿‡ ZIP æ‰“åŒ…å’Œè§£å‹ç¼©
2. **æ›´çµæ´»** - ç›´æ¥ä» API æˆ–æ–‡ä»¶ä¸Šä¼ è·å–
3. **æ›´ç®€å•** - ä¸éœ€è¦å¤„ç† ZIP æ–‡ä»¶æ ¼å¼
4. **å…¼å®¹** - ä¸å½±å“ç°æœ‰ä»£ç 
5. **å®Œæ•´** - åŒ…å«æ‰€æœ‰æ–‡æ¡£å’Œç¤ºä¾‹

## â“ å¸¸è§é—®é¢˜

**Q: å¿…é¡»ä½¿ç”¨æ–° API å—ï¼Ÿ**  
A: ä¸æ˜¯ï¼æ—§çš„ `chartUrl` æ–¹å¼ä»ç„¶å®Œå…¨æ”¯æŒã€‚

**Q: å¦‚ä½•å¤„ç†è·¨åŸŸé—®é¢˜ï¼Ÿ**  
A: å¦‚æœä½¿ç”¨ URL æ–¹å¼ï¼Œç¡®ä¿æœåŠ¡å™¨é…ç½®äº†æ­£ç¡®çš„ CORS å¤´ã€‚

**Q: Storyboard å›¾ç‰‡æ€ä¹ˆåŠï¼Ÿ**  
A: ç›®å‰æ–° API æš‚ä¸æ”¯æŒ storyboard å›¾ç‰‡ï¼Œå¦‚éœ€ä½¿ç”¨è¯·ç»§ç»­ä½¿ç”¨ ZIP æ–¹å¼ã€‚

**Q: æ€§èƒ½å¦‚ä½•ï¼Ÿ**  
A: ç”±äºè·³è¿‡äº† ZIP è§£å‹ï¼Œæ–° API æ–¹å¼åŠ è½½é€Ÿåº¦æ›´å¿«ã€‚

## ğŸ“ è·å–å¸®åŠ©

- æŸ¥çœ‹æ–‡æ¡£ï¼š`WebInterface/API.md` å’Œ `WebInterface/VUE_INTEGRATION.md`
- è¿è¡Œç¤ºä¾‹ï¼š`WebInterface/example.html`
- æµ‹è¯• APIï¼šä½¿ç”¨ `test-api.js`
- æé—®ï¼šåœ¨ GitHub Issues ä¸­æé—®

## ğŸ‰ å¼€å§‹ä½¿ç”¨

ç°åœ¨ä½ å·²ç»äº†è§£äº†æ‰€æœ‰åŠŸèƒ½ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼

1. é€‰æ‹©é€‚åˆä½ çš„é›†æˆæ–¹å¼ï¼ˆHTML æˆ– Vueï¼‰
2. å‚è€ƒå¯¹åº”çš„æ–‡æ¡£å’Œç¤ºä¾‹
3. å¼€å§‹å¼€å‘ä½ çš„é¡¹ç›®

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
